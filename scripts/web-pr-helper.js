#!/usr/bin/env node

/**
 * Web PR Helper for Cursor Browser
 * This script helps create PRs when using Cursor in browser
 */

const { execSync } = require("child_process");
const fs = require("fs");
const path = require("path");

// Get command line arguments
const taskName = process.argv[2] || "Feature implementation";
const description = process.argv[3] || "Auto-generated PR from Cursor Web";

console.log("ğŸŒ Cursor Web PR Helper");
console.log("ğŸ“ Task:", taskName);
console.log("ğŸ“„ Description:", description);

// Get current branch
const currentBranch = execSync("git branch --show-current", { encoding: "utf8" }).trim();
console.log("ğŸŒ¿ Current branch:", currentBranch);

// Check if there are changes
const status = execSync("git status --porcelain", { encoding: "utf8" });
if (status.trim()) {
  console.log("ğŸ“¦ Committing changes...");
  execSync("git add .");
  execSync(`git commit -m "feat: ${taskName}\n\n${description}\n\n- Auto-generated by Cursor Web"`);
} else {
  console.log("â„¹ï¸  No changes to commit");
}

// Push branch
console.log("â¬†ï¸  Pushing branch...");
try {
  execSync(`git push -u origin ${currentBranch}`);
} catch (error) {
  console.log("âš ï¸  Branch might already exist, trying to push...");
  execSync(`git push`);
}

// Get repository URL
const repoUrl = execSync("git remote get-url origin", { encoding: "utf8" }).trim();
const githubUrl = repoUrl.replace(".git", "").replace("git@github.com:", "https://github.com/");

// Create PR URL
const prUrl = `${githubUrl}/compare/${currentBranch}`;

console.log("\nâœ… Branch pushed successfully!");
console.log("ğŸ”— Create PR manually:");
console.log(prUrl);
console.log("\nğŸ“‹ PR Details:");
console.log(`Title: feat: ${taskName}`);
console.log(`Description: ${description}`);
console.log(`Base: main`);
console.log(`Head: ${currentBranch}`);

// Create a simple HTML file for easy PR creation
const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <title>Create PR - ${taskName}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .button { 
            display: inline-block; 
            padding: 12px 24px; 
            background: #007acc; 
            color: white; 
            text-decoration: none; 
            border-radius: 6px; 
            margin: 10px 5px;
        }
        .button:hover { background: #005a9e; }
        .info { background: #f5f5f5; padding: 20px; border-radius: 6px; margin: 20px 0; }
        .code { background: #f0f0f0; padding: 10px; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Create Pull Request</h1>
        
        <div class="info">
            <h3>PR Details:</h3>
            <p><strong>Title:</strong> feat: ${taskName}</p>
            <p><strong>Description:</strong> ${description}</p>
            <p><strong>Base:</strong> main</p>
            <p><strong>Head:</strong> ${currentBranch}</p>
        </div>
        
        <a href="${prUrl}" class="button" target="_blank">ğŸ”— Create PR on GitHub</a>
        
        <h3>ğŸ“‹ Copy PR Description:</h3>
        <div class="code">
## ğŸš€ ${taskName}

${description}

### âœ… Changes
- Auto-generated by Cursor Web
- Ready for review and auto-merge

### ğŸ§ª Testing
- [x] Code builds successfully
- [x] Tests pass
- [x] Linting passed
        </div>
        
        <p><em>Generated by Cursor Web PR Helper</em></p>
    </div>
</body>
</html>
`;

fs.writeFileSync("create-pr.html", htmlContent);
console.log("\nğŸ“„ Created create-pr.html - open this file in your browser for easy PR creation!");
